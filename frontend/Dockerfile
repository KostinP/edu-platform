# üõ†Ô∏è –°—Ç–∞–¥–∏—è —Å–±–æ—Ä–∫–∏
FROM node:20-alpine AS builder

# –£—Å—Ç–∞–Ω–æ–≤–∏–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –£—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Å–Ω–∞—á–∞–ª–∞ —Ç–æ–ª—å–∫–æ package.json ‚Äî –¥–ª—è –∫–µ—à–∞)
COPY frontend/package.json frontend/package-lock.json ./
RUN npm ci

# –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
COPY frontend .

# –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫—ç—à –±–∏–ª–¥–∞ (–µ—Å–ª–∏ –±—ã–ª)
RUN rm -rf .next

# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
RUN npm run build

# üîí –°—Ç–∞–¥–∏—è –∑–∞–ø—É—Å–∫–∞
FROM node:20-alpine AS runner

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY frontend/package.json frontend/package-lock.json ./
RUN npm ci --omit=dev

# –ö–æ–ø–∏—Ä—É–µ–º —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–∑ builder
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/next.config.js ./next.config.js
COPY --from=builder /app/tsconfig.json ./tsconfig.json
COPY --from=builder /app/src ./src

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Ä—Ç 3000
EXPOSE 3000

# –ó–∞–ø—É—Å–∫ Next.js –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
CMD ["npm", "start"]
